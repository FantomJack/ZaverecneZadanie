<!doctype html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Login page</title>

    <style>
        html {
            max-width: 70ch;
            padding: 3em 1em;
            margin: auto;
            line-height: 1.75;
            font-size: 1em;
        }

        h1,h2,h3,h4,h5,h6 {
            margin: 3em 0 1em;
        }

        p,ul,ol {
            margin-bottom: 2em;
            color: #1d1d1d;
            font-family: sans-serif;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@1.*/css/pico.min.css">
</head>
<body>
<!--<header>-->
<hgroup>
    <h1 style="font-size: 2em">Register</h1>
</hgroup>
<!--</header>-->
<main>

    <form id="registerForm">

<!--        <label for="firstname">-->
<!--            Meno:-->
<!--            <input type="text" name="firstname" value="" id="firstname" placeholder="napr. Jonatan" required>-->
<!--        </label>-->

<!--        <label for="lastname">-->
<!--            Priezvisko:-->
<!--            <input type="text" name="lastname" value="" id="lastname" placeholder="napr. Petrzlen" required>-->
<!--        </label>-->

        <label for="email">
            E-mail:
            <input type="email" name="email" value="" id="email" placeholder="napr. jpetrzlen@example.com" required>
        </label>

        <label for="login">
            Login:
            <input type="text" name="login" minlength="6" maxlength="32"  value="" id="login" placeholder="napr. jperasin" required">
        </label>

        <label for="password">
            Heslo:
            <input type="password" name="password" value="" id="password" required>
        </label>

        <button type="submit">Vytvorit konto</button>

        <p style="color: #dc3545" id="errmsg"></p>

<!--        <p>Teraz sa mozte prihlasit: <a href="login.php" role="button">Login</a></p> -->

    </form>
    <p>Mate vytvorene konto? <a href="login.php">Prihlaste sa tu.</a></p>
    <script src=".config.js"></script>
<script>
    document.getElementById("registerForm").addEventListener("submit", function(event){
        event.preventDefault();

        let email = document.getElementById("email").value;
        let login = document.getElementById("login").value;
        let password = document.getElementById("password").value;

        postData(email, login, password)

    });

    function postData(email, login, password){
        axios.post(register_api_url,
            {login: login, email: email, password: password},
            {headers: {'Content-Type': 'multipart/form-data'}})
        .then(function (result) {
            window.location.href = main_page_url;
        })
        .catch(error => {
            if (error.response) {
                // The request was made but no response was received
                let errmsg = document.getElementById("errmsg");
                errmsg.textContent = error.response.data.message;
                // The request was made and the server responded with a status code
                // console.error('Server responded with status code:', error.response.status);
                // console.error('Response data:', error.response.data);
            } else if (error.request) {
                console.error('No response received:', error.request);
            } else {
                console.error('Error during request setup:', error.message);
            }
        });


    }

</script>
</main>
</body>
</html>